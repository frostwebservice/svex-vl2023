import{j as l,l as m,d as e,k as T,aX as k,aY as V,aW as j,cv as de,cw as U,E as f,r as d,F as $,aM as se,b9 as ie,ba as ue,J as C,bb as pe,aB as Me,P as De,aN as fe,cx as me,aT as ye,O as L,aP as F,f as w,a$ as Le,G as Z,I as R,cd as q,cy as J,a as X,p as D,D as O,s as We,cz as Ge,bV as Fe,bO as Oe,bT as Ue,bA as ge,B as qe,bW as Be,cf as le,cA as oe,C as Ne,L as je,_ as ve,bx as Ke,by as $e,aE as Q,bS as _,cB as He,c as ze,S as Qe,cr as _e}from"./app-0b1a94df.js";import{u as be}from"./use-search-params-95bae2a5.js";import{d as re}from"./deep-copy-ee95be26.js";import{C as xe}from"./ClickAwayListener-d38cb663.js";import{A as Ve}from"./Attachment01-fe5ed94f.js";import{C as Ce}from"./Camera01-830251b4.js";import{S as Ze}from"./Send01-7de185c0.js";import{P as Je}from"./Plus-f9a973d9.js";import{A as Te}from"./AvatarGroup-5fe7776e.js";import{f as we}from"./index-773daa5a.js";import{C as Xe}from"./CardMedia-3e99efdd.js";import{A as Ye}from"./Archive-9e067e2a.js";import{D as et}from"./DotsHorizontal-4356fad9.js";import{T as tt}from"./Trash02-fab6519c.js";const at=()=>l(m,{sx:{alignItems:"center",display:"flex",flexGrow:1,flexDirection:"column",justifyContent:"center",overflow:"hidden"},children:[e(m,{component:"img",src:"/assets/errors/error-404.png",sx:{height:"auto",maxWidth:120}}),e(T,{color:"text.secondary",sx:{mt:2},variant:"subtitle1",children:"Start meaningful conversations!"})]}),y=new Date,G=[{id:"5e8891ab188cd2855e6029b7",avatar:"/assets/avatars/avatar-alcides-antonio.png",isActive:!0,lastActivity:y.getTime(),name:"Alcides Antonio"},{id:"5e887a62195cc5aef7e8ca5d",avatar:"/assets/avatars/avatar-marcus-finn.png",isActive:!1,lastActivity:k(y,2).getTime(),name:"Marcus Finn"},{id:"5e887ac47eed253091be10cb",avatar:"/assets/avatars/avatar-carson-darrin.png",isActive:!1,lastActivity:V(y,15).getTime(),name:"Carson Darrin"},{id:"5e887b209c28ac3dd97f6db5",avatar:"/assets/avatars/avatar-fran-perez.png",isActive:!0,lastActivity:y.getTime(),name:"Fran Perez"},{id:"5e887b7602bdbc4dbb234b27",avatar:"/assets/avatars/avatar-jie-yan-song.png",isActive:!0,lastActivity:y.getTime(),name:"Jie Yan Song"},{id:"5e86805e2bafd54f66cc95c3",avatar:"/assets/avatars/avatar-miron-vitold.png",isActive:!1,lastActivity:k(y,1).getTime(),name:"Miron Vitold"},{id:"5e887a1fbefd7938eea9c981",avatar:"/assets/avatars/avatar-penjani-inyene.png",isActive:!1,lastActivity:k(y,6).getTime(),name:"Penjani Inyene"},{id:"5e887d0b3d090c1b8f162003",avatar:"/assets/avatars/avatar-omar-darboe.png",isActive:!0,lastActivity:y.getTime(),name:"Omar Darobe"},{id:"5e88792be2d4cfb4bf0971d9",avatar:"/assets/avatars/avatar-siegbert-gottfried.png",isActive:!0,lastActivity:y.getTime(),name:"Siegbert Gottfried"},{id:"5e8877da9a65442b11551975",avatar:"/assets/avatars/avatar-iulia-albu.png",isActive:!0,lastActivity:y.getTime(),name:"Iulia Albu"},{id:"5e8680e60cba5019c5ca6fda",avatar:"/assets/avatars/avatar-nasimiyu-danai.png",isActive:!0,lastActivity:y.getTime(),name:"Nasimiyu Danai"}],K=[{id:"5e867eb9de721aecaccf4f7b",messages:[{id:"5e867f0a5bc0ff2bfa07bfa6",attachments:[],body:"Hey, nice projects! I really liked the one in react. What's your quote on kinda similar project?",contentType:"text",createdAt:j(k(y,10),4).getTime(),authorId:"5e86805e2bafd54f66cc95c3"},{id:"5e867f167d5f78109ae9f2a4",attachments:[],body:"I would need to know more details, but my hourly rate stats at $35/hour. Thanks!",contentType:"text",createdAt:j(k(y,2),4).getTime(),authorId:"5e86809283e28b96d2d38537"},{id:"5e867f1c9ca72084693528f4",attachments:[],body:"Well it's a really easy one, I'm sure we can make it half of the price.",contentType:"text",createdAt:k(y,5).getTime(),authorId:"5e86805e2bafd54f66cc95c3"},{id:"5e867f22fd2e27a09849b4db",attachments:[],body:"Then why don't you make it if it's that easy? Sorry I'm not interetes, have fantastic day Adam!",contentType:"text",createdAt:k(y,3).getTime(),authorId:"5e86809283e28b96d2d38537"},{id:"5e867f28a34d45ac6eb5c41f",attachments:[],body:"Last offer, $25 per hour",contentType:"text",createdAt:k(y,2).getTime(),authorId:"5e86805e2bafd54f66cc95c3"},{id:"5e867f2dba984a3f78b33526",attachments:[],body:"/assets/covers/minimal-1-4x3-small.png",contentType:"image",createdAt:k(y,1).getTime(),authorId:"5e86805e2bafd54f66cc95c3"}],participantIds:["5e86809283e28b96d2d38537","5e86805e2bafd54f66cc95c3"],type:"ONE_TO_ONE",unreadCount:2},{id:"5e867fa7082c3c5921403a26",messages:[{id:"5e867fc180837d901bd9bca1",attachments:[],body:"Hey, would you like to collaborate?",contentType:"text",createdAt:j(V(y,6),3).getTime(),authorId:"5e8680e60cba5019c5ca6fda"},{id:"5e8d6fb695df7971237fc173",attachments:[],body:"Hi, Merrile!",contentType:"text",createdAt:j(V(y,5),3).getTime(),authorId:"5e86809283e28b96d2d38537"},{id:"58825a290eb4d4271a54f188",attachments:[],body:"Hello everyone ğŸ˜€",contentType:"text",createdAt:j(V(y,2),1).getTime(),authorId:"5e8891ab188cd2855e6029b7"}],participantIds:["5e86809283e28b96d2d38537","5e8680e60cba5019c5ca6fda","5e8891ab188cd2855e6029b7"],type:"GROUP",unreadCount:0}],M={id:"5e86809283e28b96d2d38537",avatar:"/assets/avatars/avatar-anika-visser.png",name:"Anika Visser"},ne=a=>K.find(t=>t.id===a),he=a=>K.find(t=>{if(t.participantIds.length!==a.length)return!1;const n=new Set;return t.participantIds.forEach(s=>{a.includes(s)&&n.add(s)}),n.size===a.length});class rt{getContacts(t){const{query:n}=t;return new Promise((s,o)=>{try{let r=G;if(n){const i=n.toLowerCase().trim();r=r.filter(c=>c.name.toLowerCase().includes(i))}s(re(r))}catch(r){console.error("[Chat Api]: ",r),o(new Error("Internal server error"))}})}getThreads(t){const n=K.map(s=>{const o=[M];return G.forEach(r=>{s.participantIds.includes(r.id)&&o.push({id:r.id,avatar:r.avatar,lastActivity:r.lastActivity,name:r.name})}),{...s,participants:o}});return Promise.resolve(re(n))}getThread(t){const{threadKey:n}=t;return new Promise((s,o)=>{if(!n){o(new Error("Thread key is required"));return}try{let r;const i=G.find(u=>u.id===n);if(i&&(r=he([M.id,i.id])),r||(r=ne(n)),!r)return s(null);const c=[M];G.forEach(u=>{r.participantIds.includes(u.id)&&c.push({id:u.id,avatar:u.avatar,lastActivity:u.lastActivity,name:u.name})});const h={...r,participants:c};s(re(h))}catch(r){console.error("[Chat Api]: ",r),o(new Error("Internal server error"))}})}markThreadAsSeen(t){const{threadId:n}=t;return new Promise((s,o)=>{try{const r=K.find(i=>i.id===n);r&&(r.unreadCount=0),s(!0)}catch(r){console.error("[Chat Api]: ",r),o(new Error("Internal server error"))}})}getParticipants(t){const{threadKey:n}=t;return new Promise((s,o)=>{try{let r=[M],i=ne(n);if(i)G.forEach(c=>{i.participantIds.includes(c.id)&&r.push({id:c.id,avatar:c.avatar,lastActivity:c.lastActivity,name:c.name})});else{const c=G.find(h=>h.id===n);if(!c){o(new Error("Unable to find the contact"));return}r.push({id:c.id,avatar:c.avatar,lastActivity:c.lastActivity,name:c.name})}return s(r)}catch(r){console.error("[Chat Api]: ",r),o(new Error("Internal server error"))}})}addMessage(t){const{threadId:n,recipientIds:s,body:o}=t;return new Promise((r,i)=>{try{if(!(n||s)){i(new Error("Thread ID or recipient IDs has to be provided"));return}let c;if(n){if(c=ne(n),!c){i(new Error("Invalid thread id"));return}}else{const u=[M.id,...s||[]];c=he(u)}if(!c){const u=[M.id,...s||[]];c={id:de(),messages:[],participantIds:u,type:u.length===2?"ONE_TO_ONE":"GROUP",unreadCount:0},K.push(c)}const h={id:de(),attachments:[],body:o,contentType:"text",createdAt:new Date().getTime(),authorId:M.id};c.messages.push(h),r({threadId:c.id,message:h})}catch(c){console.error("[Chat Api]: ",c),i(new Error("Internal server error"))}})}}const P=new rt,nt=()=>async a=>{const t=await P.getContacts({});a(U.actions.getContacts(t))},st=()=>async a=>{const t=await P.getThreads();a(U.actions.getThreads(t))},it=a=>async t=>{const n=await P.getThread(a);return t(U.actions.getThread(n)),n==null?void 0:n.id},ot=a=>async t=>{await P.markThreadAsSeen(a),t(U.actions.markThreadAsSeen(a.threadId))},ct=a=>t=>{t(U.actions.setCurrentThread(a.threadId))},dt=a=>async t=>{const n=await P.addMessage(a);return t(U.actions.addMessage(n)),n.threadId},I={addMessage:dt,getContacts:nt,getThread:it,getThreads:st,markThreadAsSeen:ot,setCurrentThread:ct},Ae=a=>{const{onRecipientAdd:t,onRecipientRemove:n,recipients:s=[],...o}=a,r=d.useRef(null),[i,c]=d.useState(!1),[h,u]=d.useState(""),[g,v]=d.useState([]),p=!!(i&&h),S=g.length>0,A=d.useCallback(async x=>{const B=x.target.value;if(u(B),!B){v([]);return}try{const N=await P.getContacts({query:B}),ae=s.map(b=>b.id),z=N.filter(b=>!ae.includes(b.id));v(z)}catch(N){console.error(N)}},[s]),H=d.useCallback(()=>{p&&c(!1)},[p]),ee=d.useCallback(()=>{c(!0)},[]),te=d.useCallback(x=>{u(""),t==null||t(x)},[t]);return e($,{children:e(m,{...o,children:e(se,{children:l(m,{sx:{alignItems:"center",display:"flex",p:2},children:[e(xe,{onClickAway:H,children:l(m,{sx:{mr:1},children:[e(ie,{fullWidth:!0,onChange:A,onFocus:ee,placeholder:"Search contacts",ref:r,startAdornment:e(ue,{position:"start",children:e(C,{children:e(pe,{})})}),sx:{"&.MuiInputBase-root":{height:40,minWidth:260}},value:h}),p&&e(Me,{anchorEl:r.current,open:i,placement:"bottom-start",children:e(De,{elevation:16,sx:{borderColor:"divider",borderStyle:"solid",borderWidth:1,maxWidth:"100%",mt:1,width:320},children:S?l($,{children:[e(m,{sx:{px:2,pt:2},children:e(T,{color:"text.secondary",variant:"subtitle2",children:"Contacts"})}),e(fe,{children:g.map(x=>l(me,{onClick:()=>te(x),children:[e(ye,{children:e(L,{src:x.avatar})}),e(F,{primary:x.name,primaryTypographyProps:{noWrap:!0,variant:"subtitle2"}})]},x.id))})]}):l(m,{sx:{p:2,textAlign:"center"},children:[e(T,{gutterBottom:!0,variant:"h6",children:"Nothing Found"}),l(T,{color:"text.secondary",variant:"body2",children:[`We couldn't find any matches for "`,h,'". Try checking for typos or using complete words.']})]})})})]})}),e(T,{color:"text.secondary",sx:{mr:2},variant:"body2",children:"To:"}),e(w,{alignItems:"center",direction:"row",spacing:2,children:s.map(x=>e(Le,{avatar:e(L,{src:x.avatar}),label:x.name,onDelete:()=>n==null?void 0:n(x.id)},x.id))})]})})})})};Ae.propTypes={onRecipientAdd:f.func,onRecipientRemove:f.func,recipients:f.array};const Y=a=>{const{disabled:t,onSend:n,...s}=a,o=q(),r=d.useRef(null),[i,c]=d.useState(""),h=d.useCallback(()=>{var p;(p=r.current)==null||p.click()},[]),u=d.useCallback(p=>{c(p.target.value)},[]),g=d.useCallback(()=>{i&&(n==null||n(i),c(""))},[i,n]),v=d.useCallback(p=>{p.code==="Enter"&&g()},[g]);return l(w,{alignItems:"center",direction:"row",spacing:2,sx:{px:3,py:1},...s,children:[e(L,{sx:{display:{xs:"none",sm:"inline"}},src:o.avatar}),e(ie,{disabled:t,fullWidth:!0,onChange:u,onKeyUp:v,placeholder:"Leave a message",size:"small",value:i}),l(m,{sx:{alignItems:"center",display:"flex",m:-2,ml:2},children:[e(Z,{title:"Send",children:e(m,{sx:{m:1},children:e(R,{color:"primary",disabled:!i||t,sx:{backgroundColor:"primary.main",color:"primary.contrastText","&:hover":{backgroundColor:"primary.dark"}},onClick:g,children:e(C,{children:e(Ze,{})})})})}),e(Z,{title:"Attach photo",children:e(m,{sx:{display:{xs:"none",sm:"inline-flex"},m:1},children:e(R,{disabled:t,edge:"end",onClick:h,children:e(C,{children:e(Ce,{})})})})}),e(Z,{title:"Attach file",children:e(m,{sx:{display:{xs:"none",sm:"inline-flex"},m:1},children:e(R,{disabled:t,edge:"end",onClick:h,children:e(C,{children:e(Ve,{})})})})})]}),e("input",{hidden:!0,ref:r,type:"file"})]})};Y.propTypes={disabled:f.bool,onSend:f.func};Y.defaultProps={disabled:!1};const lt=()=>{const[a,t]=d.useState([]),n=d.useCallback(o=>{t(r=>r.find(c=>c.id===o.id)?r:[...r,o])},[]),s=d.useCallback(o=>{t(r=>r.filter(i=>i.id!==o))},[]);return{handleRecipientAdd:n,handleRecipientRemove:s,recipients:a}},ht=a=>{const t=J(),n=X(),{handleRecipientAdd:s,handleRecipientRemove:o,recipients:r}=lt(),i=d.useCallback(async h=>{const u=r.map(v=>v.id);let g;try{g=await t(I.addMessage({recipientIds:u,body:h}))}catch(v){console.error(v);return}n.push(D.dashboard.chat+`?threadKey=${g}`)},[t,n,r]),c=r.length>0;return l(m,{sx:{display:"flex",flexDirection:"column",flexGrow:1},...a,children:[e(Ae,{onRecipientAdd:s,onRecipientRemove:o,recipients:r}),e(O,{}),e(m,{sx:{flexGrow:1}}),e(O,{}),e(Y,{disabled:!c,onSend:i})]})},ut=We("div",{shouldForwardProp:a=>a!=="open"})(({theme:a,open:t})=>({display:"flex",flexDirection:"column",flexGrow:1,overflow:"hidden",[a.breakpoints.up("md")]:{marginLeft:-380},transition:a.transitions.create("margin",{easing:a.transitions.easing.sharp,duration:a.transitions.duration.leavingScreen}),...t&&{[a.breakpoints.up("md")]:{marginLeft:0},transition:a.transitions.create("margin",{easing:a.transitions.easing.easeOut,duration:a.transitions.duration.enteringScreen})}})),ke=d.forwardRef((a,t)=>{const{isFocused:n,onChange:s,onClickAway:o=()=>{},onFocus:r,onSelect:i,query:c="",results:h=[],...u}=a,g=d.useCallback(A=>{i==null||i(A)},[i]),v=n&&!c,p=n&&c,S=h.length>0;return e(xe,{onClickAway:o,children:l(m,{ref:t,sx:{p:2},...u,children:[e(ie,{fullWidth:!0,onChange:s,onFocus:r,placeholder:"Search contacts",startAdornment:e(ue,{position:"start",children:e(C,{children:e(pe,{})})}),value:c}),v&&e(m,{sx:{py:2},children:e(Ge,{message:"Enter a contact name"})}),p&&e($,{children:S?l(m,{sx:{py:2},children:[e(T,{color:"text.secondary",variant:"subtitle2",children:"Contacts"}),e(fe,{children:h.map(A=>l(me,{onClick:()=>g(A),children:[e(ye,{children:e(L,{src:A.avatar,sx:{height:32,width:32}})}),e(F,{primary:A.name,primaryTypographyProps:{noWrap:!0,variant:"subtitle2"}})]},A.id))})]}):e(m,{sx:{py:2},children:l(T,{color:"text.secondary",variant:"body2",children:[`We couldn't find any matches for "`,c,'". Try checking for typos or using complete words.']})})})]})})});ke.propTypes={isFocused:f.bool,onChange:f.func,onClickAway:f.func,onFocus:f.func,onSelect:f.func,query:f.string,results:f.array};const pt=a=>{var t;return(t=a.messages)==null?void 0:t[a.messages.length-1]},ft=(a,t)=>a.filter(n=>n.id!==t),mt=a=>a.map(t=>t.name).join(", "),yt=(a,t)=>{if(!t)return"";const n=t.authorId===a?"Me: ":"",s=t.contentType==="image"?"Sent a photo":t.body;return`${n}${s}`},gt=a=>a?Oe(a.createdAt,new Date,{addSuffix:!1,locale:Ue}):null,ce=a=>{const{active:t,thread:n,onSelect:s,...o}=a,r=q(),i=ft(n.participants||[],r.id),c=pt(n),h=gt(c),u=mt(i),g=yt(r.id,c),v=i.length>1,p=!!(n.unreadCount&&n.unreadCount>0);return l(w,{component:"li",direction:"row",onClick:s,spacing:2,sx:{borderRadius:2.5,cursor:"pointer",px:3,py:2,"&:hover":{backgroundColor:"action.hover"},...t&&{backgroundColor:"action.hover"}},...o,children:[e("div",{children:e(Te,{max:2,sx:{[`& .${Fe.root}`]:v?{height:26,width:26,"&:nth-of-type(2)":{mt:"10px"}}:{height:36,width:36}},children:i.map(S=>e(L,{src:S.avatar||void 0},S.id))})}),l(m,{sx:{flexGrow:1,overflow:"hidden"},children:[e(T,{noWrap:!0,variant:"subtitle2",children:u}),l(w,{alignItems:"center",direction:"row",spacing:1,children:[p&&e(m,{sx:{backgroundColor:"primary.main",borderRadius:"50%",height:8,width:8}}),e(T,{color:"text.secondary",noWrap:!0,sx:{flexGrow:1},variant:"subtitle2",children:g})]})]}),h&&e(T,{color:"text.secondary",sx:{whiteSpace:"nowrap"},variant:"caption",children:h})]})};ce.propTypes={active:f.bool,onSelect:f.func,thread:f.object.isRequired};ce.defaultProps={active:!1};const vt=(a,t)=>{let n;return a.type==="GROUP"?n=a.id:n=a.participantIds.find(s=>s!==t),n},bt=()=>oe(a=>a.chat.threads),xt=()=>oe(a=>a.chat.currentThreadId),Ie=a=>{const{container:t,onClose:n,open:s,...o}=a,r=q(),i=X(),c=bt(),h=xt(),[u,g]=d.useState(!1),[v,p]=d.useState(""),[S,A]=d.useState([]),H=ge(b=>b.breakpoints.up("md")),ee=d.useCallback(()=>{i.push(D.dashboard.chat+"?compose=true")},[i]),te=d.useCallback(async b=>{const{value:E}=b.target;if(p(E),!E){A([]);return}try{const W=await P.getContacts({query:E});A(W)}catch(W){console.error(W)}},[]),x=d.useCallback(()=>{u&&(g(!1),p(""))},[u]),B=d.useCallback(()=>{g(!0)},[]),N=d.useCallback(b=>{const E=b.id;g(!1),p(""),i.push(D.dashboard.chat+`?threadKey=${E}`)},[i]),ae=d.useCallback(b=>{const E=c.byId[b],W=vt(E,r.id);W?i.push(D.dashboard.chat+`?threadKey=${W}`):i.push(D.dashboard.chat)},[i,c,r]),z=l("div",{children:[l(w,{alignItems:"center",direction:"row",spacing:2,sx:{p:2},children:[e(T,{variant:"h5",sx:{flexGrow:1},children:"Chats"}),e(qe,{onClick:ee,startIcon:e(C,{children:e(Je,{})}),variant:"contained",children:"Group"}),!H&&e(R,{onClick:n,children:e(C,{children:e(Be,{})})})]}),e(ke,{isFocused:u,onChange:te,onClickAway:x,onFocus:B,onSelect:N,query:v,results:S}),e(m,{sx:{display:u?"none":"block"},children:e(se,{children:e(w,{component:"ul",spacing:.5,sx:{listStyle:"none",m:0,p:2},children:c.allIds.map(b=>e(ce,{active:h===b,onSelect:()=>ae(b),thread:c.byId[b]},b))})})})]});return H?e(le,{anchor:"left",open:s,PaperProps:{sx:{position:"relative",width:380}},SlideProps:{container:t},variant:"persistent",...o,children:z}):e(le,{anchor:"left",hideBackdrop:!0,ModalProps:{container:t,sx:{pointerEvents:"none",position:"absolute"}},onClose:n,open:s,PaperProps:{sx:{maxWidth:"100%",width:380,pointerEvents:"auto",position:"absolute"}},SlideProps:{container:t},variant:"temporary",...o,children:z})};Ie.propTypes={container:f.any,onClose:f.func,open:f.bool};const Se=a=>{const{authorAvatar:t,authorName:n,body:s,contentType:o,createdAt:r,position:i,...c}=a,h=we(r);return e(m,{sx:{display:"flex",alignItems:i==="right"?"flex-end":"flex-start"},...c,children:l(w,{alignItems:"flex-start",direction:i==="right"?"row-reverse":"row",spacing:2,sx:{maxWidth:500,ml:i==="right"?"auto":0,mr:i==="left"?"auto":0},children:[e(L,{src:t||void 0,sx:{height:32,width:32}}),l(m,{sx:{flexGrow:1},children:[l(Ne,{sx:{backgroundColor:i==="right"?"primary.main":"background.paper",color:i==="right"?"primary.contrastText":"text.primary",px:2,py:1},children:[e(m,{sx:{mb:1},children:e(je,{color:"inherit",sx:{cursor:"pointer"},variant:"subtitle2",children:n})}),o==="image"&&e(Xe,{onClick:()=>{},image:s,sx:{height:200,width:200}}),o==="text"&&e(T,{color:"inherit",variant:"body1",children:s})]}),e(m,{sx:{display:"flex",justifyContent:i==="right"?"flex-end":"flex-start",mt:1,px:2},children:l(T,{color:"text.secondary",noWrap:!0,variant:"caption",children:[h," ","ago"]})})]})]})})};Se.propTypes={authorAvatar:f.string.isRequired,authorName:f.string.isRequired,body:f.string.isRequired,contentType:f.string.isRequired,createdAt:f.number.isRequired,position:f.oneOf(["left","right"])};const Ct=(a,t,n)=>{const s=t.find(o=>o.id===a.authorId);return s?a.authorId===n.id?{name:"Me",avatar:n.avatar,isUser:!0}:{avatar:s.avatar,name:s.name,isUser:!1}:{name:"Unknown",avatar:"",isUser:!1}},Re=a=>{const{messages:t,participants:n,...s}=a,o=q();return e(w,{spacing:2,sx:{p:3},...s,children:t.map(r=>{const i=Ct(r,n,o);return e(Se,{authorAvatar:i.avatar,authorName:i.name,body:r.body,contentType:r.contentType,createdAt:r.createdAt,position:i.isUser?"right":"left"},r.id)})})};Re.propTypes={messages:f.array,participants:f.array};var Tt=function(t){return e("svg",ve({xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"none"},t,{children:e("path",{fill:"#fff",fillOpacity:.01,stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.3803 8.8534c.696 1.4496 1.6448 2.8082 2.8463 4.0098 1.2016 1.2016 2.5603 2.1504 4.0099 2.8464.1247.0598.187.0898.2659.1128.2804.0817.6246.023.862-.147.0669-.0479.124-.105.2383-.2193.3496-.3497.5244-.5245.7002-.6387a2 2 0 0 1 2.1804 0c.1758.1142.3506.289.7002.6387l.1948.1948c.5315.5315.7972.7972.9415 1.0826a1.9998 1.9998 0 0 1 0 1.8054c-.1443.2853-.41.5511-.9415 1.0825l-.1576.1576c-.5296.5297-.7944.7945-1.1545.9967-.3995.2244-1.02.3858-1.4782.3844-.4129-.0012-.6952-.0813-1.2596-.2415-3.0334-.861-5.8958-2.4854-8.2837-4.8734-2.388-2.388-4.0125-5.2504-4.8735-8.2838-.1602-.5644-.2403-.8466-.2415-1.2596-.0014-.4582.16-1.0787.3844-1.4782.2023-.36.467-.6248.9967-1.1545l.1576-.1576C5 3.1801 5.2656 2.9143 5.551 2.77a2 2 0 0 1 1.8054 0c.2853.1443.551.41 1.0825.9415l.1949.1949c.3496.3496.5244.5244.6387.7002a2 2 0 0 1 0 2.1803c-.1143.1758-.2891.3506-.6387.7002-.1143.1143-.1715.1715-.2193.2383-.17.2374-.2287.5817-.147.862.023.079.053.1413.1128.266Z"})}))},wt=function(t){return l("svg",ve({xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"none"},t,{children:[e("path",{fill:"#fff",fillOpacity:.01,d:"M12 21c4.9706 0 9-4.0294 9-9s-4.0294-9-9-9-9 4.0294-9 9 4.0294 9 9 9Z"}),e("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"m5.637 5.637 12.726 12.726M21 12c0 4.9706-4.0294 9-9 9s-9-4.0294-9-9 4.0294-9 9-9 9 4.0294 9 9Z"})]}))};const At=(a,t)=>a.filter(n=>n.id!==t),kt=a=>a.map(t=>t.name).join(", "),It=a=>a.length===1&&a[0].lastActivity?we(a[0].lastActivity,{addSuffix:!0}):null,Pe=a=>{const{participants:t=[],...n}=a,s=q(),o=Ke(),r=At(t,s.id),i=kt(r),c=It(r);return l($,{children:[l(w,{alignItems:"center",direction:"row",justifyContent:"space-between",spacing:2,sx:{flexShrink:0,minHeight:64,px:2,py:1},...n,children:[l(w,{alignItems:"center",direction:"row",spacing:2,children:[e(Te,{max:2,sx:{...r.length>1&&{"& .MuiAvatar-root":{height:30,width:30,"&:nth-of-type(2)":{mt:"10px"}}}},children:r.map(h=>e(L,{src:h.avatar||void 0},h.id))}),l("div",{children:[e(T,{variant:"subtitle2",children:i}),c&&l(T,{color:"text.secondary",variant:"caption",children:["Last active"," ",c]})]})]}),l(w,{alignItems:"center",direction:"row",spacing:1,children:[e(R,{children:e(C,{children:e(Tt,{})})}),e(R,{children:e(C,{children:e(Ce,{})})}),e(Z,{title:"More options",children:e(R,{onClick:o.handleOpen,ref:o.anchorRef,children:e(C,{children:e(et,{})})})})]})]}),l($e,{anchorEl:o.anchorRef.current,keepMounted:!0,onClose:o.handleClose,open:o.open,children:[l(Q,{children:[e(_,{children:e(C,{children:e(wt,{})})}),e(F,{primary:"Block"})]}),l(Q,{children:[e(_,{children:e(C,{children:e(tt,{})})}),e(F,{primary:"Delete"})]}),l(Q,{children:[e(_,{children:e(C,{children:e(Ye,{})})}),e(F,{primary:"Archive"})]}),l(Q,{children:[e(_,{children:e(C,{children:e(He,{})})}),e(F,{primary:"Mute"})]})]})]})};Pe.propTypes={participants:f.array};const St=a=>{const t=X(),[n,s]=d.useState([]),o=d.useCallback(async()=>{try{const r=await P.getParticipants({threadKey:a});s(r)}catch(r){console.error(r),t.push(D.dashboard.chat)}},[t,a]);return d.useEffect(()=>{o()},[a]),n},Rt=a=>{const t=X(),n=J(),s=oe(r=>{const{threads:i,currentThreadId:c}=r.chat;return i.byId[c]}),o=d.useCallback(async()=>{let r;try{r=await n(I.getThread({threadKey:a}))}catch(i){console.error(i),t.push(D.dashboard.chat);return}n(I.setCurrentThread({threadId:r})),r&&n(I.markThreadAsSeen({threadId:r}))},[t,n,a]);return d.useEffect(()=>{o()},[a]),s},Pt=a=>{const t=d.useRef(null),n=d.useCallback(()=>{if(!a||!t.current)return;const s=t.current,o=s.getScrollElement();o&&(o.scrollTop=s.el.scrollHeight)},[a]);return d.useEffect(()=>{n()},[a]),{messagesRef:t}},Ee=a=>{const{threadKey:t,...n}=a,s=J(),o=q(),r=Rt(t),i=St(t),{messagesRef:c}=Pt(r),h=d.useCallback(async u=>{if(r){try{await s(I.addMessage({threadId:r.id,body:u}))}catch(p){console.error(p)}return}const g=i.filter(p=>p.id!==o.id).map(p=>p.id);let v;try{v=await s(I.addMessage({recipientIds:g,body:u}))}catch(p){console.error(p);return}try{await s(I.getThread({threadKey:v}))}catch(p){console.error(p);return}s(I.setCurrentThread({threadId:v}))},[s,i,r,o]);return l(w,{sx:{flexGrow:1,overflow:"hidden"},...n,children:[e(Pe,{participants:i}),e(O,{}),e(m,{sx:{flexGrow:1,overflow:"hidden"},children:e(se,{ref:c,sx:{maxHeight:"100%"},children:e(Re,{messages:(r==null?void 0:r.messages)||[],participants:(r==null?void 0:r.participants)||[]})})}),e(O,{}),e(Y,{onSend:h})]})};Ee.propTypes={threadKey:f.string.isRequired};const Et=()=>{const a=J(),t=d.useCallback(()=>{a(I.getThreads())},[a]);d.useEffect(()=>{t()},[])},Mt=()=>{const a=be(),t=ge(h=>h.breakpoints.up("md")),[n,s]=d.useState(t),o=d.useCallback(()=>{s(!!t)},[t]);d.useEffect(()=>{o()},[t]);const r=d.useCallback(()=>{t||s(!1)},[t]);d.useEffect(()=>{r()},[a]);const i=d.useCallback(()=>{s(h=>!h)},[]),c=d.useCallback(()=>{s(!1)},[]);return{handleToggle:i,handleClose:c,open:n}},zt=()=>{const a=d.useRef(null),t=be(),n=t.get("compose")==="true",s=t.get("threadKey")||void 0,o=Mt();ze(),Et();const r=s?"thread":n?"compose":"blank";return l($,{children:[e(Qe,{title:"Dashboard: Chat"}),e(O,{}),e(m,{component:"main",sx:{backgroundColor:"background.paper",flex:"1 1 auto",overflow:"hidden",position:"relative"},children:l(m,{ref:a,sx:{bottom:0,display:"flex",left:0,position:"absolute",right:0,top:0},children:[e(Ie,{container:a.current,onClose:o.handleClose,open:o.open}),l(ut,{open:o.open,children:[e(m,{sx:{p:2},children:e(R,{onClick:o.handleToggle,children:e(C,{children:e(_e,{})})})}),e(O,{}),r==="thread"&&e(Ee,{threadKey:s}),r==="compose"&&e(ht,{}),r==="blank"&&e(at,{})]})]})})]})};export{zt as default};
